<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute morphological and intensity features from objects on images. — measureObjects • cytomapper</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute morphological and intensity features from objects on images. — measureObjects"><meta property="og:description" content="For each object (e.g. cell) identified by segmentation, the
measureObjects function computes intensity features (also referred to
as basic features; e.g. mean intensity), shape features (e.g. area), moment
features (e.g. position) and haralick features. These features are returned
in form of a SingleCellExperiment or 
SpatialExperiment object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cytomapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.15.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/cytomapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cytomapper_ondisk.html">On disk storage and handling of images</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BodenmillerGroup/cytomapper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute morphological and intensity features from objects on images.</h1>
    <small class="dont-index">Source: <a href="https://github.com/BodenmillerGroup/cytomapper/blob/HEAD/R/measureObjects.R" class="external-link"><code>R/measureObjects.R</code></a></small>
    <div class="hidden name"><code>measureObjects.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For each object (e.g. cell) identified by segmentation, the
<code>measureObjects</code> function computes intensity features (also referred to
as basic features; e.g. mean intensity), shape features (e.g. area), moment
features (e.g. position) and haralick features. These features are returned
in form of a <a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a> or 
SpatialExperiment object.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">measureObjects</span><span class="op">(</span></span>
<span>  <span class="va">mask</span>,</span>
<span>  <span class="va">image</span>,</span>
<span>  <span class="va">img_id</span>,</span>
<span>  return_as <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sce"</span>, <span class="st">"spe"</span><span class="op">)</span>,</span>
<span>  feature_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basic"</span>, <span class="st">"shape"</span>, <span class="st">"moment"</span><span class="op">)</span>,</span>
<span>  basic_feature <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  basic_quantiles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shape_feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area"</span>, <span class="st">"radius.mean"</span><span class="op">)</span>,</span>
<span>  moment_feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cx"</span>, <span class="st">"cy"</span>, <span class="st">"majoraxis"</span>, <span class="st">"eccentricity"</span><span class="op">)</span>,</span>
<span>  haralick_feature <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  haralick_nbins <span class="op">=</span> <span class="fl">32</span>,</span>
<span>  haralick_scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>mask</dt>
<dd><p>a <code><a href="CytoImageList.html">CytoImageList</a></code> object containing single-channel
<code><a href="https://rdrr.io/pkg/EBImage/man/Image.html" class="external-link">Image</a></code> or <code>HDF5Array</code> objects.
Segmentation masks must contain integer pixel values where groups of
pixels correspond to objects.</p></dd>


<dt>image</dt>
<dd><p>a <code><a href="CytoImageList.html">CytoImageList</a></code> object containing single or
multi-channel <code><a href="https://rdrr.io/pkg/EBImage/man/Image.html" class="external-link">Image</a></code> or <code>HDF5Array</code>
objects, where each channel indicates the measured pixel intensities.</p></dd>


<dt>img_id</dt>
<dd><p>character specifying the <code>mcols(image)</code> and
<code>mcols(mask)</code> entry, in which the image IDs are stored.</p></dd>


<dt>return_as</dt>
<dd><p>single character specifying the class of the returned object.
This is either <code>"sce"</code> to return a <code>SingleCellExperiment</code> (default)
or <code>"spe"</code> to return a <code>SpatialExperiment</code> object.</p></dd>


<dt>feature_types</dt>
<dd><p>character vector or string indicating which features to
compute. Needs to contain <code>"basic"</code>. Optionally, <code>"shape"</code>,
<code>"moment"</code> and <code>"haralick"</code> are allowed. Default <code>"basic"</code>,
<code>"shape"</code> and <code>"moment"</code>.</p></dd>


<dt>basic_feature</dt>
<dd><p>string indicating which intensity measurement per object
and channel should be used to populate the <code>counts(x)</code> slot; where
<code>x</code> is the returned object. Default
<code>"mean"</code> but <code>"sd"</code>, <code>"mad"</code> and <code>"q*"</code> allowed. Here,
<code>*</code> indicates the computed quantile (see <code>basic_quantiles</code>).</p></dd>


<dt>basic_quantiles</dt>
<dd><p>numeric vector or single number indicating which
quantiles to compute. Default none.</p></dd>


<dt>shape_feature</dt>
<dd><p>string or character vector specifying which shape
features to compute. Default <code>"area"</code> and <code>"radius.mean"</code>.
Allowed entries are: <code>"area"</code>, <code>"perimeter"</code>,
<code>"radius.mean"</code>, <code>"radius.sd"</code>, <code>"radius.max"</code>,
<code>"radius.min"</code>.</p></dd>


<dt>moment_feature</dt>
<dd><p>string or character vector indicating which moment
features to compute. Default <code>"cx"</code>, <code>"cy"</code>, <code>"majoraxis"</code>,
and <code>"eccentricity"</code>. Other allowed features are <code>"theta"</code>. Here
moment features are only computed on the segmentation mask without
incorporating pixel intensities. Therefore, <code>"cx"</code> and <code>"cy"</code> are
the x and y coordinates of the cell centroids.</p></dd>


<dt>haralick_feature</dt>
<dd><p>string or character vector indicating which haralick
features to compute. Default none. Allowed are the 13 haralick features:
<code>"asm"</code>, <code>"con"</code>, <code>"cor"</code>, <code>"var"</code>, <code>"idm"</code>,
<code>"sav"</code>, <code>"sva"</code>, <code>"sen"</code>, <code>"ent"</code>, <code>"dva"</code>,
<code>"den"</code>, <code>"f12"</code>, <code>"f13"</code></p></dd>


<dt>haralick_nbins</dt>
<dd><p>an integer indicating the number of bins used to
compute the haralick matrix. Pixel intensities are binned in
<code>haralick_nbins</code> discrete gray levels before computing the haralick
matrix.</p></dd>


<dt>haralick_scales</dt>
<dd><p>an integer vector indicating the number of scales
(distance at which to consider neighbouring pixels) to use to compute the
haralick features.</p></dd>


<dt>BPPARAM</dt>
<dd><p>parameters for parallelised processing of images.
See <code>MulticoreParam</code> for information on how to use multiple
cores for parallelised processing.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a> or 
SpatialExperiment object (see details)</p>
    </div>
    <div id="the-returned-objects">
    <h2>The returned objects</h2>
    

<p>By default, a <code>SingleCellExperiment</code> object is returned. When setting
<code>return_as = "spe"</code>, the returned object is of class
<code>SpatialExperiment</code>. The returned object contains a single assay. This
assay contains individual objects in columns and channels in rows. Each entry
summarises the intensities per object and channel. This summary statistic is
typically the mean intensity per object and channel. However, other summary
statistics can be computed. When the mean intensity per object and channel is
computed (default), the assay is accessible via <code>counts(sce)</code>.
Otherwise, the assay needs to be accessed via <code>assay(sce, "counts_*")</code>,
where <code>*</code> indicates the argument to <code>basic_feature</code>.</p>
<p>The <code>colData(x)</code> entry is populated by the computed shape, moment and
haralick features per object. The prefix of the feature names indicate
whether these features correspond to shape (<code>s.</code>), moment (<code>m.</code>) or
haralick (<code>h.</code>) features. Default features are the following:</p>
<ul><li><p>s.area - object size in pixels</p></li>
<li><p>s.radius.mean - mean object radius in pixels</p></li>
<li><p>m.cx - x centroid position of object</p></li>
<li><p>m.cy - y centroid position of object</p></li>
<li><p>m.majoraxis - major axis length in pixels of elliptical fit</p></li>
<li><p>m.eccentricity - elliptical eccentricity. 1 meaning straight line and 0
meaning circle.</p></li>
</ul></div>
    <div id="computing-quantiles">
    <h2>Computing quantiles</h2>
    

<p>Sometimes it can be useful to describe the summarised pixel intensity per
object and channel not in terms of the mean but some quantile of the pixel
distribution. For example, to compute the median pixel intensity per object
and channel, set <code>basic_feature = "q05"</code> and <code>basic_quantiles =
0.5</code>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/EBImage/man/computeFeatures.html" class="external-link">computeFeatures</a></code>, for detailed explanation for the computed features.
<a href="https://earlglynn.github.io/RNotes/package/EBImage/Haralick-Textural-Features.html" class="external-link">https://earlglynn.github.io/RNotes/package/EBImage/Haralick-Textural-Features.html</a>
for more discussion on the haralick features</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Nils Eling (<a href="mailto:nils.eling@dqbm.uzh.ch">nils.eling@dqbm.uzh.ch</a>),</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Standard example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pancreasImages</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pancreasMasks</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">measureObjects</span><span class="op">(</span><span class="va">pancreasMasks</span>, <span class="va">pancreasImages</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sce</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: SingleCellExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dim: 5 362 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> metadata(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> assays(1): counts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rownames(5): H3 CD99 PIN CD8a CDH</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rowData names(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> colnames: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> colData names(9): ImageNb object_id ... m.eccentricity ImageName</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reducedDimNames(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mainExpName: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> altExpNames(0):</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute only intensity feature</span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">measureObjects</span><span class="op">(</span><span class="va">pancreasMasks</span>, <span class="va">pancreasImages</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span>,</span></span>
<span class="r-in"><span>                        feature_types <span class="op">=</span> <span class="st">"basic"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 362 rows and 3 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       ImageNb object_id   ImageName</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1       824         E34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1       835         E34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1       839         E34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           1       844         E34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           1       847         E34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...         ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 358         3      4165         J02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 359         3      4167         J02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 360         3      4173         J02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 361         3      4190         J02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 362         3      4209         J02</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize on segmentation masks</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotCells.html">plotCells</a></span><span class="op">(</span><span class="va">pancreasMasks</span>, object <span class="op">=</span> <span class="va">sce</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span>,</span></span>
<span class="r-in"><span>            cell_id <span class="op">=</span> <span class="st">"object_id"</span>, colour_by <span class="op">=</span> <span class="st">"PIN"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="measureObjects-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nils Eling, Nicolas Damond, Lasse Meyer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

