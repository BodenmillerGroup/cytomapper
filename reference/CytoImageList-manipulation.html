<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Manipulating CytoImageList objects — CytoImageList-manipulation • cytomapper</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Manipulating CytoImageList objects — CytoImageList-manipulation"><meta property="og:description" content="Methods to change pixel values in CytoImageList objects. In the
following sections, object is a CytoImageList object
containing one or multiple channels."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cytomapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/cytomapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cytomapper_ondisk.html">On disk storage and handling of images</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BodenmillerGroup/cytomapper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Manipulating CytoImageList objects</h1>
    <small class="dont-index">Source: <a href="https://github.com/BodenmillerGroup/cytomapper/blob/HEAD/R/CytoImageList-utils.R" class="external-link"><code>R/CytoImageList-utils.R</code></a></small>
    <div class="hidden name"><code>CytoImageList-manipulation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Methods to change pixel values in CytoImageList objects. In the
following sections, <code>object</code> is a <a href="CytoImageList.html">CytoImageList</a> object
containing one or multiple channels.</p>
    </div>


    <div id="value">
    <h2>Value</h2>
    

<p>A CytoImageList object containing the manipulated Images.</p>
    </div>
    <div id="image-scaling">
    <h2>Image scaling</h2>
    

<p>In some cases, images need to be scaled by a constant
(e.g. 2^16-1 = 65535) <code>value</code> to revert them back to the original
pixel values after reading them in.</p><dl><dt><code>scaleImages(object, value)</code></dt>
<dd><p>Scales all images in the
<a href="CytoImageList.html">CytoImageList</a> <code>object</code> by <code>value</code>. Here <code>value</code>
needs to be a single numeric or a numeric vector of the same length as
<code>object</code>.</p></dd>


</dl></div>
    <div id="image-normalization">
    <h2>Image normalization</h2>
    

<p>Linear scaling of the intensity values of each <a href="https://rdrr.io/pkg/EBImage/man/Image.html" class="external-link">Image</a> contained
in a <a href="CytoImageList.html">CytoImageList</a> <code>object</code> to a specific range. Images
can either be scaled to the minimum/maximum value per channel or across all
channels (default <code>separateChannels = TRUE</code>). Also, images can be scaled
to the minimum/maximum value per image or across all images (default
<code>separateImages = FALSE</code>). The latter allows the visual comparison of
intensity values across images.</p>
<p>To clip the images before normalization, the <code>inputRange</code> can be set.
The <code>inputRange</code> either takes NULL (default), a vector of length 2
specifying the clipping range for all channels or a list where each
named entry contains a channel-specific clipping range.</p>
<p>Image normalization also works for images stored on disk. By default,
the normalized images are stored as a second entry called "XYZ_norm"
in the .h5 file. Here "XYZ" specifies the name of the original entry.
By storing the normalized next to the original images on disk, space
usage increases. To avoid storing duplicated data, one can specify
<code>overwrite = TRUE</code>, therefore deleting the original images
and only storing the normalized images. However, the original images
cannot be accessed anymore after normalisation.</p>
<p><code>normalize(object, separateChannels = TRUE, separateImages = FALSE,
ft = c(0, 1), inputRange = NULL, overwrite = FALSE)</code>:</p>
<dl><dt><code>object</code>:</dt>
<dd><p>A CytoImageList object</p></dd>

<dt><code>separateChannels</code>:</dt>
<dd><p>Logical if pixel values should be normalized
per channel (default) or across all channels.</p></dd>

<dt><code>separateImages</code>:</dt>
<dd><p>Logical if pixel values should be normalized
per image or across all images (default).</p></dd>

<dt><code>ft</code>:</dt>
<dd><p>Numeric vector of 2 values, target minimum and maximum
intensity values after normalization (see <code><a href="https://rdrr.io/pkg/BiocGenerics/man/normalize.html" class="external-link">normalize</a></code>).</p></dd>

<dt><code>inputRange</code>:</dt>
<dd><p>Numeric vector of 2 values, sets the absolute
clipping range of the input intensity values (see
<code><a href="https://rdrr.io/pkg/BiocGenerics/man/normalize.html" class="external-link">normalize</a></code>). Alternatively a names list where each
entry corresponds to a channel-specific clipping range.</p></dd>

<dt><code>overwrite</code>:</dt>
<dd><p>Only relevant when images are kept on disk. By
specifying <code>overwrite = TRUE</code>, the normalized images will overwrite
the original images in the .h5 file, therefore reducing space on disk.
However, the original images cannot be accessed anymore after normalization.
If <code>overwrite = FALSE</code> (default), the normalized images are added as
a new entry called "XYZ_norm" to the .h5 file.</p></dd>
)

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/BiocGenerics/man/normalize.html" class="external-link">normalize</a></code> for details on Image normalization</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Nils Eling (<a href="mailto:nils.eling@dqbm.uzh.ch">nils.eling@dqbm.uzh.ch</a>)</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pancreasImages</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Scale images to create segmentation masks</span></span></span>
<span class="r-in"><span><span class="va">cur_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"cytomapper"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        pattern <span class="op">=</span> <span class="st">"mask.tiff"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="loadImages.html">loadImages</a></span><span class="op">(</span><span class="va">cur_files</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Error when running plotCells(x)</span></span></span>
<span class="r-in"><span><span class="co"># Therefore scale to account for 16 bit encoding</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">scaleImages</span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">^</span><span class="fl">16</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotCells.html">plotCells</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CytoImageList-manipulation-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Default normalization</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">pancreasImages</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotPixels.html">plotPixels</a></span><span class="op">(</span><span class="va">x</span>, colour_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H3"</span>, <span class="st">"CD99"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CytoImageList-manipulation-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting the clipping range</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">x</span>, inputRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotPixels.html">plotPixels</a></span><span class="op">(</span><span class="va">x</span>, colour_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H3"</span>, <span class="st">"CD99"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CytoImageList-manipulation-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting the clipping range per channel</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">pancreasImages</span>,</span></span>
<span class="r-in"><span>                inputRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>H3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">70</span><span class="op">)</span>, CD99 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotPixels.html">plotPixels</a></span><span class="op">(</span><span class="va">x</span>, colour_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H3"</span>, <span class="st">"CD99"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CytoImageList-manipulation-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Normalizing per image</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">pancreasImages</span>, separateImages <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotPixels.html">plotPixels</a></span><span class="op">(</span><span class="va">x</span>, colour_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H3"</span>, <span class="st">"CD99"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CytoImageList-manipulation-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nils Eling, Nicolas Damond.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

