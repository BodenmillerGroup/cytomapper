<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Performs channel compensation on multi-channel images — compImage • cytomapper</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Performs channel compensation on multi-channel images — compImage"><meta property="og:description" content="Corrects the intensity spillover between neighbouring channels
of multi-channel images using a non-negative least squares approach."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cytomapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/cytomapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cytomapper_ondisk.html">On disk storage and handling of images</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BodenmillerGroup/cytomapper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Performs channel compensation on multi-channel images</h1>
    <small class="dont-index">Source: <a href="https://github.com/BodenmillerGroup/cytomapper/blob/HEAD/R/compImage.R" class="external-link"><code>R/compImage.R</code></a></small>
    <div class="hidden name"><code>compImage.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Corrects the intensity spillover between neighbouring channels
of multi-channel images using a non-negative least squares approach.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compImage</span><span class="op">(</span><span class="va">object</span>, <span class="va">sm</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span>, BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>a <code>CytoImageList</code> object containing pixel
intensities for all channels. The <code>channelNames</code> must be in the form
of <code>(mt)(mass)Di</code> (e.g. <code>Sm152Di</code> for Samarium isotope with the
atomic mass 152) and match with the column names in <code>sm</code>.</p></dd>


<dt>sm</dt>
<dd><p>numeric matrix containing the spillover estimated between channels.
The column names must be of the form <code>(mt)(mass)Di</code> (e.g.
<code>Sm152Di</code> for Samarium isotope with the atomic mass 152) and match to
the <code>channelNames</code> of <code>object</code>.</p></dd>


<dt>overwrite</dt>
<dd><p>(for images stored on disk) should the original image array
be overwritten by the compensated image array? By default (<code>overwrite
= FALSE</code>), a new entry called "XYZ_comp" will be written to the .h5  file
(see below).</p></dd>


<dt>BPPARAM</dt>
<dd><p>parameters for parallelised processing.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>returns the compensated pixel intensities in form of a 
<code>CytoImageList</code> object.</p>
    </div>
    <div id="the-input-object">
    <h2>The input object</h2>
    

<p>The <code>channelNames</code> of <code>object</code> need to match the column names
of <code>sm</code>. To adapt the spillover matrix accordingly, please use the
<code>adaptSpillmat</code> function.</p>
    </div>
    <div id="images-stored-on-disk">
    <h2>Images stored on disk</h2>
    

<p>Image compensation also works for images stored on disk. By default,
the compensated images are stored as a second entry called "XYZ_comp"
in the .h5 file. Here "XYZ" specifies the name of the original entry.
By storing the compensated next to the original images on disk, space
usage increases. To avoid storing duplicated data, one can specify
<code>overwrite = TRUE</code>, therefore deleting the original images
and only storing the compensated images. However, the original images
cannot be accessed anymore after compensation.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p><a href="https://www.sciencedirect.com/science/article/pii/S2405471217305434" class="external-link">
Chevrier, S. et al., Compensation of Signal Spillover in Suspension 
and Imaging Mass Cytometry., Cell Systems 2018 6(5):612-620.e5</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/nnls/man/nnls.html" class="external-link">nnls</a></code>, for the underlying algorithm</p>
<p><code>compCytof</code>, for how to compensate single-cell data</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Nils Eling (<a href="mailto:nils.eling@dqbm.uzh.ch">nils.eling@dqbm.uzh.ch</a>)</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pancreasImages"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate example spillover matrix</span></span></span>
<span class="r-in"><span><span class="va">metals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dy161Di"</span>, <span class="st">"Dy162Di"</span>, <span class="st">"Dy163Di"</span>, <span class="st">"Dy164Di"</span>, <span class="st">"Ho165Di"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.033</span>, <span class="fl">0.01</span>, <span class="fl">0.007</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>               <span class="fl">0.016</span>, <span class="fl">1</span>, <span class="fl">0.051</span>, <span class="fl">0.01</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>               <span class="fl">0.004</span>, <span class="fl">0.013</span>, <span class="fl">1</span>, <span class="fl">0.023</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>               <span class="fl">0.005</span>, <span class="fl">0.008</span>, <span class="fl">0.029</span>, <span class="fl">1</span>, <span class="fl">0.006</span>,</span></span>
<span class="r-in"><span>               <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">1</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>             ncol <span class="op">=</span> <span class="fl">5</span>, nrow <span class="op">=</span> <span class="fl">5</span>, </span></span>
<span class="r-in"><span>             dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">metals</span>, <span class="va">metals</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>             </span></span>
<span class="r-in"><span><span class="co"># Rename channels - just used as example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="CytoImageList-naming.html">channelNames</a></span><span class="op">(</span><span class="va">pancreasImages</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">metals</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Perform channel spillover</span></span></span>
<span class="r-in"><span><span class="va">comp_images</span> <span class="op">&lt;-</span> <span class="fu">compImage</span><span class="op">(</span><span class="va">pancreasImages</span>, <span class="va">sm</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nils Eling, Nicolas Damond.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

