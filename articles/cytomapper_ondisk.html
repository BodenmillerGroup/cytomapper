<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>On disk storage and handling of images • cytomapper</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="On disk storage and handling of images">
<meta property="og:description" content="cytomapper">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cytomapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cytomapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cytomapper_ondisk.html">On disk storage and handling of images</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BodenmillerGroup/cytomapper/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cytomapper_ondisk_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>On disk storage and handling of images</h1>
                        <h4 class="author">Nils Eling</h4>
            <address class="author_afil">
      Department for Quantitative Biomedicine, University of Zurich<br><a class="author_email" href="mailto:#"></a><a href="mailto:nils.eling@dqbm.uzh.ch" class="email">nils.eling@dqbm.uzh.ch</a>
      </address>
                  
            <h4 class="date">28 October 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BodenmillerGroup/cytomapper/blob/master/vignettes/cytomapper_ondisk.Rmd"><code>vignettes/cytomapper_ondisk.Rmd</code></a></small>
      <div class="hidden name"><code>cytomapper_ondisk.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>To scale the functionality of the <code>cytomapper</code> package, images can be stored on disk. For this, images are written onto disk as arrays in hdf5 format. Writing and accessing these arrays is facilitated by the <code>HDF5Array</code> and <code>DelayedArray</code> Bioconductor packages. The functionality of <code>cytomapper</code>remains the same, the only change is how images are read in. This vignette will give an overview on how to work with images stored on disk.</p>
    </div>
    
<div id="Introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#Introduction" class="anchor"></a>Introduction</h1>
<p><em><a href="https://bioconductor.org/packages/3.14/HDF5Array">HDF5Array</a></em> and <em><a href="https://bioconductor.org/packages/3.14/DelayedArray">DelayedArray</a></em> are convenient Bioconductor packages to work with arrays “on disk” instead of “in memory”. The <code>cytomapper</code> package builds upon these tools to allow storing image data on disk. While this facilitates the handling of hundreds to thousand of images in parallel, little changes are experienced from the user perspective. Here, we explain which <code>cytomapper</code> function are effected by storing images on disk.</p>
</div>
<div id="ReadingData" class="section level1">
<h1 class="hasAnchor">
<a href="#ReadingData" class="anchor"></a>Reading in data to disk</h1>
<p>The <code>loadImages</code> function takes extra arguments to specify if images should be stored on disk (<code>on_disk</code>) and where to store them (<code>h5FilesPath</code>). When images should be stored for longer than the current R session, the <code>h5FilesPath</code> needs to be set to a permanent directory. The <code>HDF5Array</code> package provides the <code>getHDF5DumpDir</code> function, which initialize a temporary directory, which will be deleted once the session closes. This is what we will use here for demonstration purposes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/HDF5Array">HDF5Array</a></span><span class="op">)</span>

<span class="co"># Define output directory</span>
<span class="va">cur_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/HDF5Array/man/dump-management.html">getHDF5DumpDir</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">path.to.images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"cytomapper"</span><span class="op">)</span>
<span class="va">image.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadImages.html">loadImages</a></span><span class="op">(</span><span class="va">path.to.images</span>, pattern <span class="op">=</span> <span class="st">"mask.tiff"</span>,
                             on_disk <span class="op">=</span> <span class="cn">TRUE</span>, h5FilesPath <span class="op">=</span> <span class="va">cur_dir</span><span class="op">)</span>

<span class="co"># Show list</span>
<span class="va">image.list</span></code></pre></div>
<pre><code>## CytoImageList containing 3 image(s)
## names(3): E34_mask G01_mask J02_mask 
## Each image contains 1 channel</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Scale images</span>
<span class="va">image.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-manipulation.html">scaleImages</a></span><span class="op">(</span><span class="va">image.list</span>, value <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fl">16</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">image.list</span><span class="op">$</span><span class="va">E34_mask</span></code></pre></div>
<pre><code>## &lt;100 x 100&gt; matrix of class DelayedMatrix and type "double":
##          [,1]   [,2]   [,3] ...  [,99] [,100]
##   [1,]    824    824    824   .   1265   1265
##   [2,]    824    824    824   .   1265      0
##   [3,]    824    824    824   .      0      0
##   [4,]    824    824    824   .      0   1295
##   [5,]    824    824    824   .      0   1295
##    ...      .      .      .   .      .      .
##  [96,]    835      0    876   .      0      0
##  [97,]    835      0    876   .      0      0
##  [98,]    835      0    876   .   1293   1293
##  [99,]      0      0    876   .   1293   1293
## [100,]      0      0      0   .   1293   1293</code></pre>
<p>This function call reads in the .tiff images before writing them as .h5 files to the indicated directory. It generates a <code>CytoImageList</code> object that contains <code>HDF5Array</code> or <code>DelayedArray</code> objects (instead of <code>Image</code> objects) in each slot, which references the data in the .h5 files. The name of the array within the .h5 file is automatically set as the original filename and cannot be changed easily from within R. Writing the images to disk is slow and therefore less efficient compared to keeping images in memory. However, when working with hundreds of images in parallel, all images remain accessible from within the R session if they are stored on disk. In conclusion: when working with small image sets it is recommended reading them into memory (<code>on_disk = FALSE</code>, default), while large image sets should be written to disk (<code>on_disk = TRUE</code>). When reading in the same images multiple times, the .h5 files will always be replaced.</p>
<p>Please follow the <a href="https://bioconductor.org/packages/release/bioc/vignettes/cytomapper/inst/doc/cytomapper.html">main vignette</a> for instructions on how to work with multi-channel images in R.</p>
</div>
<div id="Converting" class="section level1">
<h1 class="hasAnchor">
<a href="#Converting" class="anchor"></a>Converting from on disk to memory and back</h1>
<p>Existing <code>CytoImageList</code> objects, which contain individual <code>Image</code> objects in memory can be converted into <code>CytoImageList</code> objects storing <code>DelayedArray</code> or <code>HDF5Array</code> objects on disk. For this the following function calls can be used:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"pancreasImages"</span><span class="op">)</span>

<span class="va">pancreasImages_onDisk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-class.html">CytoImageList</a></span><span class="op">(</span><span class="va">pancreasImages</span>,
                                        on_disk <span class="op">=</span> <span class="cn">TRUE</span>, 
                                        h5FilesPath <span class="op">=</span> <span class="va">cur_dir</span><span class="op">)</span>

<span class="co"># Image object</span>
<span class="va">pancreasImages</span><span class="op">$</span><span class="va">E34_imc</span></code></pre></div>
<pre><code>## Image 
##   colorMode    : Grayscale 
##   storage.mode : double 
##   dim          : 100 100 5 
##   frames.total : 5 
##   frames.render: 5 
## 
## imageData(object)[1:5,1:6,1]
##           [,1]      [,2]         [,3]      [,4]         [,5]         [,6]
## [1,] 2.2357869 0.2537275 1.269632e+00 0.9991982 1.990020e+00 0.000000e+00
## [2,] 2.8855283 1.9900196 2.264642e+00 0.0000000 1.410924e+00 5.654589e-16
## [3,] 3.4009433 0.9950098 9.950098e-01 2.1800663 4.152935e-17 1.990020e+00
## [4,] 3.2238317 3.1750760 1.128341e+00 4.4866042 7.371460e-16 0.000000e+00
## [5,] 0.9987666 1.9900196 2.644036e-15 0.0000000 0.000000e+00 1.523360e+00</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># HDF5Array object</span>
<span class="va">pancreasImages_onDisk</span><span class="op">$</span><span class="va">E34_imc</span></code></pre></div>
<pre><code>## &lt;100 x 100 x 5&gt; array of class HDF5Array and type "double":
## ,,H3
##             [,1]      [,2]      [,3] ...     [,99]    [,100]
##   [1,] 2.2357869 0.2537275 1.2696325   .  7.265561  1.975094
##   [2,] 2.8855283 1.9900196 2.2646422   .  2.985029  2.885528
##    ...         .         .         .   .         .         .
##  [99,]  2.985029  3.636569 22.976585   . 25.371881 12.045588
## [100,]  3.061645  2.985029  1.990020   . 13.353615  5.636652
## 
## ...
## 
## ,,CDH
##             [,1]      [,2]      [,3] ...    [,99]   [,100]
##   [1,]  0.940284 19.651394 43.284626   . 2.704231 0.000000
##   [2,]  8.393239 29.353861 22.249359   . 7.345311 5.781126
##    ...         .         .         .   .        .        .
##  [99,] 0.9897148 7.3378549 0.0000000   . 0.000000 1.667201
## [100,] 5.8091230 2.2515676 1.9969171   . 4.344125 0.000000</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Seed of HDF5Array object</span>
<span class="fu">seed</span><span class="op">(</span><span class="va">pancreasImages_onDisk</span><span class="op">$</span><span class="va">E34_imc</span><span class="op">)</span></code></pre></div>
<pre><code>## An object of class "HDF5ArraySeed"
## Slot "filepath":
## [1] "/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmpgxcrwk/HDF5Array_dump/E34_imc.h5"
## 
## Slot "name":
## [1] "/E34_imc"
## 
## Slot "as_sparse":
## [1] FALSE
## 
## Slot "type":
## [1] NA
## 
## Slot "dim":
## [1] 100 100   5
## 
## Slot "chunkdim":
## [1] 100 100   5
## 
## Slot "first_val":
## [1] 2.235787</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Size in memory</span>
<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">pancreasImages</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1.2 Mb"</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "12.1 Kb"</code></pre>
<p>Images can also be moved back to in memory representation:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pancreasImages_inMemory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-class.html">CytoImageList</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span>,
                                        on_disk <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Compare the image data to the original representation</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">pancreasImages_inMemory</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">pancreasImages</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="Functionality" class="section level1">
<h1 class="hasAnchor">
<a href="#Functionality" class="anchor"></a>Effects on package functionality</h1>
<p>While most functions of the <code>cytomapper</code> package natively support images stored on disk, there are three exceptions: the <code>normalize</code>, <code>setChannels</code> and <code>mergeChannels</code> functions.</p>
<p>The <code>normalize</code> function will store the normalized images as a second dataset in the same .h5 file as the original data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Size of object in memory</span>
<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "12.1 Kb"</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Size of object on disk in kB</span>
<span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cur_dir</span>, <span class="st">"/E34_imc.h5"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="st">"size"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">1000</span></code></pre></div>
<pre><code>## [1] 148.147</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pancreasImages_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-manipulation.html">normalize</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span><span class="op">)</span>

<span class="fu">seed</span><span class="op">(</span><span class="va">pancreasImages_norm</span><span class="op">$</span><span class="va">E34_imc</span><span class="op">)</span></code></pre></div>
<pre><code>## An object of class "HDF5ArraySeed"
## Slot "filepath":
## [1] "/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmpgxcrwk/HDF5Array_dump/E34_imc.h5"
## 
## Slot "name":
## [1] "/E34_imc_norm"
## 
## Slot "as_sparse":
## [1] FALSE
## 
## Slot "type":
## [1] NA
## 
## Slot "dim":
## [1] 100 100   5
## 
## Slot "chunkdim":
## [1] 100 100   5
## 
## Slot "first_val":
## [1] 0.01235403</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Size of object in memory</span>
<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">pancreasImages_norm</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "12.1 Kb"</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Size of object on disk in kB</span>
<span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cur_dir</span>, <span class="st">"/E34_imc.h5"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="st">"size"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">1000</span></code></pre></div>
<pre><code>## [1] 414.936</code></pre>
<p>As we can see, the size in memory does not increase when normalizing images. However, the size on disk increases since a second, normalized dataset is stored in the .h5 file. The original dataset can be overwritten by setting <code>overwrite = TRUE</code> to save space on disk. This will however break the links to the original data in all R objects. It is therefore recommended leaving the default <code>overwrite = FALSE</code>. Furthermore, the normalization of images stored on disk is slower compared to normalizing images in memory since normalized images need to be written to disk.</p>
<p>The <code>setChannels</code> function replaces the same channels in all images by a user defined channel. There is no problem with this when keeping images in memory. However, the <code>DelayedArray</code> framework stores the replacement value in subassignemt operations in memory. This means that when using the <code>setChannels</code> function, the size of the object increases in memory usage:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cur_Images1</span> <span class="op">&lt;-</span> <span class="va">pancreasImages_onDisk</span>
<span class="va">cur_Images2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-subsetting.html">getChannels</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/CytoImageList-naming.html">channelNames</a></span><span class="op">(</span><span class="va">cur_Images2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"CD99_2"</span>

<span class="fu">setChannels</span><span class="op">(</span><span class="va">cur_Images1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cur_Images2</span>
<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">cur_Images1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "27.7 Kb"</code></pre>
<p>The <code>mergeChannels</code> function merges multiple user-defined channels. As this operation creates a completely new image object, one needs to store the merged channels in a different location:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">channels1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-subsetting.html">getChannels</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
<span class="va">channels2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-subsetting.html">getChannels</a></span><span class="op">(</span><span class="va">pancreasImages_onDisk</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cur_dir</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cur_path_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cur_dir</span>, <span class="st">"test"</span><span class="op">)</span>

<span class="va">channels3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytoImageList-subsetting.html">mergeChannels</a></span><span class="op">(</span><span class="va">channels1</span>, <span class="va">channels2</span>,
                            h5FilesPath <span class="op">=</span> <span class="va">cur_path_2</span><span class="op">)</span>

<span class="fu">seed</span><span class="op">(</span><span class="va">channels3</span><span class="op">$</span><span class="va">E34_imc</span><span class="op">)</span></code></pre></div>
<pre><code>## An object of class "HDF5ArraySeed"
## Slot "filepath":
## [1] "/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmpgxcrwk/HDF5Array_dump/test/E34_imc.h5"
## 
## Slot "name":
## [1] "/E34_imc"
## 
## Slot "as_sparse":
## [1] FALSE
## 
## Slot "type":
## [1] NA
## 
## Slot "dim":
## [1] 100 100   4
## 
## Slot "chunkdim":
## [1] 100 100   4
## 
## Slot "first_val":
## [1] 2.235787</code></pre>
</div>
<div id="session-info" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<pre><code>## R version 4.1.1 (2021-08-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] HDF5Array_1.20.0            rhdf5_2.36.0               
##  [3] DelayedArray_0.18.0         Matrix_1.3-4               
##  [5] cytomapper_1.7.0            SingleCellExperiment_1.14.1
##  [7] SummarizedExperiment_1.22.0 Biobase_2.52.0             
##  [9] GenomicRanges_1.44.0        GenomeInfoDb_1.28.4        
## [11] IRanges_2.26.0              S4Vectors_0.30.2           
## [13] BiocGenerics_0.38.0         MatrixGenerics_1.4.3       
## [15] matrixStats_0.61.0          EBImage_4.34.0             
## [17] BiocStyle_2.20.2           
## 
## loaded via a namespace (and not attached):
##  [1] bitops_1.0-7           fs_1.5.0               RColorBrewer_1.1-2    
##  [4] rprojroot_2.0.2        tools_4.1.1            bslib_0.3.1           
##  [7] svgPanZoom_0.3.4       utf8_1.2.2             R6_2.5.1              
## [10] vipor_0.4.5            colorspace_2.0-2       rhdf5filters_1.4.0    
## [13] raster_3.5-2           sp_1.4-5               gridExtra_2.3         
## [16] compiler_4.1.1         textshaping_0.3.6      desc_1.4.0            
## [19] bookdown_0.24          sass_0.4.0             scales_1.1.1          
## [22] pkgdown_1.6.1          systemfonts_1.0.3      stringr_1.4.0         
## [25] digest_0.6.28          tiff_0.1-8             fftwtools_0.9-11      
## [28] svglite_2.0.0          rmarkdown_2.11         XVector_0.32.0        
## [31] jpeg_0.1-9             pkgconfig_2.0.3        htmltools_0.5.2       
## [34] fastmap_1.1.0          htmlwidgets_1.5.4      rlang_0.4.12          
## [37] shiny_1.7.1            jquerylib_0.1.4        jsonlite_1.7.2        
## [40] BiocParallel_1.26.2    RCurl_1.98-1.5         magrittr_2.0.1        
## [43] GenomeInfoDbData_1.2.6 Rcpp_1.0.7             ggbeeswarm_0.6.0      
## [46] munsell_0.5.0          Rhdf5lib_1.14.2        fansi_0.5.0           
## [49] viridis_0.6.2          abind_1.4-5            terra_1.4-11          
## [52] lifecycle_1.0.1        stringi_1.7.5          yaml_2.2.1            
## [55] zlibbioc_1.38.0        grid_4.1.1             promises_1.2.0.1      
## [58] shinydashboard_0.7.2   crayon_1.4.1           lattice_0.20-44       
## [61] locfit_1.5-9.4         knitr_1.36             pillar_1.6.4          
## [64] codetools_0.2-18       glue_1.4.2             evaluate_0.14         
## [67] BiocManager_1.30.16    png_0.1-7              vctrs_0.3.8           
## [70] httpuv_1.6.3           gtable_0.3.0           cachem_1.0.6          
## [73] ggplot2_3.3.5          xfun_0.27              mime_0.12             
## [76] xtable_1.8-4           later_1.3.0            viridisLite_0.4.0     
## [79] ragg_1.1.3             tibble_3.1.5           beeswarm_0.4.0        
## [82] memoise_2.0.0          ellipsis_0.3.2</code></pre>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nils Eling, Nicolas Damond.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
